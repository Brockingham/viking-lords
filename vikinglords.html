<head>
  <title>Viking Lords</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
</body>

<template name="lobby">
  <div class="container">
    {{#if isSignedIn}}
      {{> welcome}}
      <div class="row">
        <div class="col-lg-4">
          {{> myGames }}
        </div>
        <div class="col-lg-4">
          {{> createGame}}
        </div>
        <div class="col-lg-4">
          {{> joinGame}}
        </div>
      </div>
    {{else}}
      {{> signIn}}
    {{/if}}
  </div>
</template>

<template name="signIn">
  <h1>Sign In</h1>
  <form class="form-horizontal">
    <div class="form-group">
      <label for="username" class="col-lg-1 control-label">Username</label>
      <div class="col-lg-3">
        <input type="text" class="form-control" name="username" id="username" placeholder="username" />
      </div>
    </div>
    <div class="form-group">
      <div class="col-lg-offset-1 col-lg-1">
        <button type="submit" class="btn btn-default">Sign In</button>
      </div>
    </div>
  </form>
</template>

<template name="welcome">
  <h1>Welcome {{userName}}!</h1>
  <button class="sign-out btn btn-default btn-xs">Sign Out</button>
</template>

<template name="myGames">
	<h2>My Games</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    {{#each myGames}}
      <tr>
        <td>{{name}}</td>
        <td>{{status}}</td>
        <td><a href="/games/{{_id}}" class="btn btn-default">Play</a></td>
      </tr>
    {{/each}}
  </table>
</template>

<template name="createGame">
  <h2>Create Game</h2>
  <form>
    <div class="form-group">
      <label for="gameName" class="control-label">Name</label>
      <input type="text" class="form-control" name="gameName" id="gameName" placeholder="Game name" />
    </div>
    <div class="form-group">
      <button type="submit" class="btn btn-default">Create</button>
    </div>
  </form>
</template>

<template name="joinGame">
  <h2>Join Game</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Players</th>
        <th></th>
      </tr>
    </thead>
    {{#each openGames}}
      <tr>
        <td>{{name}}</td>
        <td>{{numberOfPlayers}}/4</td>
        <td><button class="join-game btn btn-default">Join</button></td>
      </tr>
    {{/each}}
  </table>
</template>

<template name="game">
  <div class="container">
    <div class="row">
      <div class="col-lg-6">
        <h1>Viking Lords <small>{{name}}</small></h1>
        <a href="/lobby" class="btn btn-default btn-xs">Back to Lobby</a>
      </div>
    </div>
    {{#if isOpen}}
      <div class="row">
        <div class="col-lg-6">
          <h4>Waiting for more Players</h4>
          <p>Current players: {{playerList}}</p>
          {{#if canStart}}
            <button class="start-game btn btn-primary">Start Game</button>
          {{/if}}
        </div>
      </div>
    {{/if}}
    {{#if isComplete}}
      <div class="row">
        <div class="col-lg-6">
        <h2>Game Over!</h2>
        </div>
      </div>
    {{/if}}
    {{#if isStarted}}
      <div class="row">
        <div class="col-lg-4">
          <h4>Players</h4>
          <table class="table">
            <thead>
              <tr>
                <th></th>
                <th class="text-center">Current Turn</th>
                <th class="text-center">Lead Viking</th>
                <th class="text-center">Last This Round</th>
                <th class="text-center">Common</th>
                <th class="text-center">Rare</th>
              </tr>
            </thead>
            {{#each currentState.players}}
              <tr>
                <td>{{#if isUser}}<em>You - </em>{{/if}}{{user.name}}</td>
                <td class="text-center">{{#if isCurrentPlayer}}<span class="fa fa-check"></span>{{/if}}</td>
                <td class="text-center">{{#if leadViking}}<span class="fa fa-check"></span>{{/if}}</td>
                <td class="text-center">{{#if lastViking}}<span class="fa fa-check"></span>{{/if}}</td>
                <td class="text-center">{{#with resourcePicks.common}}<img src="{{imagePathForResource}}" title="{{this}}" alt="{{this}}" height="16" width="16">{{/with}}</td>
                <td class="text-center">{{#with resourcePicks.rare}}<img src="{{imagePathForResource}}" title="{{this}}" alt="{{this}}" height="16" width="16">{{/with}}</td>
              </tr>
            {{/each}}
          </table>
        </div>
        {{#if inPlayStep}}
          <div class="col-lg-8">
            {{> stash}}
          </div>
        {{/if}}
      </div>
    {{/if}}
    {{#if inSetupStep}}
      <div class="row">
        <div class="col-lg-6">
          {{> setupStep}}
        </div>
      </div>
    {{/if}}
    {{#if inPlayStep}}
      {{> playStep}}
    {{/if}}
  </div>
</template>

<template name="setupStep">
  <h4>Choose Resources</h4>
  <h6>Common Resources</h6>
  <ul class="list-inline">
  {{#each currentState.availableCommonResources}}
    <li><img src="{{imagePathForResource}}" title="{{this}}" alt="{{this}}" height="16" width="16"> {{#if needToPickCommon}}{{#if isUsersTurn}}<button class="pick-common btn btn-default">Select</button>{{/if}}{{/if}}</li>
  {{/each}}
  </ul>
  <h6>Rare Resources</h6>
  <ul class="list-inline">
  {{#each currentState.availableRareResources}}
    <li><img src="{{imagePathForResource}}" title="{{this}}" alt="{{this}}" height="16" width="16">{{#if needToPickCommon}}{{else}}{{#if isUsersTurn}}<button class="pick-rare btn btn-default">Select</button>{{/if}}{{/if}}</li>
  {{/each}}
  </ul>
</template>

<template name="playStep">
  <div class="row">
    <div class="col-lg-8">
      <h4>Structures & Clansmen</h4>
      <table class="table">
        <thead>
          <tr>
            <th></th>
            <th class="text-center">Taverns</th>
            <th class="text-center">Mead Halls</th>
            <th class="text-center">Longboats</th>
            <th class="text-center">Skalds</th>
            <th class="text-center">Vikings</th>
          </tr>
        </thead>
        {{#each currentState.players}}
          <tr>
            <td class="text-center">
              {{#if isUser}}<em>You - </em>{{/if}}{{user.name}}
            </td>
            <td class="text-center">
              {{structures.tavern}}
              {{#if isUser}}
                <button class="activate-tavern btn btn-default">Convert 1 Rare ({{structureUses.tavern}} left)</button>
              {{/if}}
            </td>
            <td class="text-center">
              {{structures.meadhall}}
              {{#if isUser}}
                <button class="activate-meadhall btn btn-default">Convert 1 Common ({{structureUses.meadhall}} left)</button>
              {{/if}}
            </td>
            <td class="text-center">
              {{structures.longboat}}
            </td>
            <td class="text-center">
              {{clansmen.skald}}
              {{#if isUser}}{{#if isUsersTurn2}}
                <button class="perform-skald btn btn-default">Perform</button>
                <button class="sacrifice-skald btn btn-default">Sacrifice</button>
              {{/if}}{{/if}}
            </td>
            <td class="text-center">
              {{clansmen.viking}}
            </td>
          </tr>
        {{/each}}
      </table>
    </div>
    <div class="col-lg-4">
    <h4>Purchased</h4>
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th class="text-center">Taverns</th>
          <th class="text-center">Mead Halls</th>
          <th class="text-center">Longboats</th>
        </tr>
      </thead>
      {{#each currentState.players}}
        <tr>
          <td class="text-center">{{#if isUser}}<em>You - </em>{{/if}}{{user.name}}</td>
          <td class="text-center">{{purchased.tavern}}</td>
          <td class="text-center">{{purchased.meadhall}}</td>
          <td class="text-center">{{purchased.longboat}}</td>
        </tr>
      {{/each}}
    </table>
    </div>
  </div>

	{{#if currentPlayerGivingSkald}}
		<h4>Choose who to give the Skald to:</h4>
		{{#each currentState.players}}
			{{#if isUser}}{{else}}<button class="give-skald" value="{{user._id}}">{{user.name}}</button>{{/if}}
		{{/each}}
	{{/if}}

	<h2>Actions</h2>
	<h3>Convert:</h3>
	{{#if currentUserConvertingResources}}
		Convert which resources?
		<button class="convert" value="blue">Blue</button>
		<button class="convert" value="green">Green</button>
		<button class="convert" value="red">Red</button>
		<button class="convert" value="purple">Purple</button>
	{{else}}
		<td>{{#if isUsersTurn}}<button class="convert-to-rare">Convert 2 Common to 1 Rare</button>{{/if}}</td>
		<td>{{#if isUsersTurn}}<button class="convert-to-geld">Convert 4 Resources to 1 Geld</button>{{/if}}</td>
	{{/if}}

	<h3>Shared Tracks</h3>
	{{#if currentPlayerTrading}}
		<h4>Make a trading post selection</h4>
		{{#if currentPlayerTradingStep1}}
			Which resource do you want to trade <b>away</b>?
			<button class="trade-away" value="blue">Blue</button>
			<button class="trade-away" value="green">Green</button>
			<button class="trade-away" value="red">Red</button>
			<button class="trade-away" value="purple">Purple</button>
		{{else}}
			Which resource do you want to trade <b>for</b>?
			<button class="trade-for" value="blue">Blue</button>
			<button class="trade-for" value="green">Green</button>
			<button class="trade-for" value="red">Red</button>
			<button class="trade-for" value="purple">Purple</button>
		{{/if}}
	{{else}}
		<table>
		<tr>
			<td>Track</td>
			<td>Cost #1</td>
			<td>Cost #2</td>
			<td>Cost #3</td>
			<td>Cost #4</td>
		</tr>
		{{#each currentState.sharedTracks}}
		<tr>
			<td>{{name}}</td>
			{{#each buySlots}}
				<td>
					{{#if bought}}
						<s>{{cost}}</s>
					{{else}}
						{{cost}}
					{{/if}}
					{{#if available}}
						{{#if isUsersTurn3}}
							<button class="buy-track" value="{{../name}}">Buy</button>
						{{/if}}
					{{/if}}
				</td>
			{{/each}}
		</tr>
		{{/each}}
	</table>
	{{/if}}

	{{#if currentPlayerRaiding}}
	<h3>Attack</h3>
		{{#if currentPlayerDecidingWhoToRaid}}
			Who do you want to attack?
			{{#each currentState.players}}
				{{#if isUser}}
				{{else}}
					<button class="choose-who-to-raid" value="{{user._id}}">{{user.name}}</button>
				{{/if}}
			{{/each}}
			<button class="choose-who-to-raid" value="">Do not attack</button>
		{{/if}}
		{{#if currentPlayerDecidingHowToRaid}}
			How do you want to attack?
			<button class="choose-how-to-raid" value="take">Take stuff</button>
			<button class="choose-how-to-raid" value="burn">Burn something</button>
			<button class="choose-how-to-raid" value="both">Take stuff and burn something</button>
		{{/if}}
		{{#if currentPlayerWaitingOnDefender}}
			Waiting for defender to decide whether or not to defend.
		{{/if}}
		{{#if currentPlayerDecidingWhatToBurn}}
			What do you want to burn?
			<button class="burn-structure" value="tavern">Tavern</button>
			<button class="burn-structure" value="meadhall">Mead Hall</button>
			<button class="burn-structure" value="longboat">Longboat</button>
		{{/if}}
		{{#if currentUserDecidingWhatToTake}}
			What do you want to take?
			<button class="steal-resource" value="blue">Blue</button>
			<button class="steal-resource" value="green">Green</button>
			<button class="steal-resource" value="red">Red</button>
			<button class="steal-resource" value="purple">Purple</button>
		{{/if}}
	{{/if}}

	{{#if currentUserCollectingBounty}}
		<h3>Offering - Bounty</h3>
		Choose a resource to collect
		<button class="collect-bounty" value="blue">Blue</button>
		<button class="collect-bounty" value="green">Green</button>
		<button class="collect-bounty" value="red">Red</button>
		<button class="collect-bounty" value="purple">Purple</button>
	{{/if}}

	{{#if currentUserSmiting}}
		<h3>Offering - Smite</h3>
		{{#if currentPlayerDecidingWhoToSmite}}
			Who do you want to smite?
			{{#each currentState.players}}
				{{#if isUser}}
				{{else}}
					<button class="choose-who-to-smite" value="{{user._id}}">{{user.name}}</button>
				{{/if}}
			{{/each}}
			<button class="choose-who-to-smite" value="">Do not smite</button>
		{{/if}}
		{{#if currentPlayerDecidingWhatToSmite}}
			What do you want to smite?
			<button class="choose-what-to-smite" value="tavern">Tavern</button>
			<button class="choose-what-to-smite" value="meadhall">Mead Hall</button>
			<button class="choose-what-to-smite" value="longboat">Longboat</button>
		{{/if}}
	{{/if}}

	{{#if currentUserValkyring}}
		<h3>Offering - Valkyrie</h3>
		{{#if currentPlayerDecidingWhoToValkyrie}}
			Who do you want to valkyrie?
			{{#each currentState.players}}
				{{#if isUser}}
				{{else}}
					<button class="choose-who-to-valkyrie" value="{{user._id}}">{{user.name}}</button>
				{{/if}}
			{{/each}}
			<button class="choose-who-to-valkyrie" value="">Do not valkyrie</button>
		{{/if}}
		{{#if currentPlayerDecidingWhatToValkyrie}}
			What do you want to valkyrie?
			<button class="choose-what-to-valkyrie" value="viking">Viking</button>
			<button class="choose-what-to-valkyrie" value="skald">Skald</button>
		{{/if}}
	{{/if}}

	{{#if currentUserBeingScourged}}
		<h3>Offering - Scourge</h3>
		Choose a resource to destroy
		<button class="scourge-resource" value="blue">Blue</button>
		<button class="scourge-resource" value="green">Green</button>
		<button class="scourge-resource" value="red">Red</button>
		<button class="scourge-resource" value="purple">Purple</button>
	{{/if}}

	{{#if currentUserUnderAttack}}
	<h3>Defend</h3>
		Sacrifice a Viking to defend your village?
		<button class="defend-attack" value="true">Yes</button>
		<button class="defend-attack" value="false">No</button>
	{{/if}}

	<h3>MarketPlace:</h3>
	<table>
	<tr>
		<td>Stucture</td>
		<td>Cost</td>
		<td></td>
	</tr>
	{{#each marketplace}}
	<tr>
		<td>{{name}}</td>
		<td>{{#each resourceCost}}<img src="{{imagePathForResource}}" title="{{this}}" alt="{{this}}" height="16" width="16">{{/each}}</td>
		<td>{{#if isUsersTurn2}}<button class="buy-marketplace" value="{{name}}">Buy</button>{{/if}}</td>
	</tr>
	{{/each}}
	</table>

	<h3>Pay Weregeld:</h3>
	<ul>
	{{#if isUsersTurn}}
		{{#each currentUserWeregeld}}
			<li><button class="pay-weregeld" value="{{user._id}}">Pay {{user.name}}</button></li>
		{{/each}}
	{{/if}}
	</ul>

  <h2>Decks</h2>
	<h3>Omens</h3>
	<ol>
	{{#each currentState.playedOmens}}
		<li>{{this}}</li>
	{{/each}}
	</ol>
	<h3>Offerings</h3>
	<ol>
	{{#each currentState.playedOfferings}}
		<li>{{this}}</li>
	{{/each}}
	</ol>

	<h3>End Turn:</h3>
	{{#if isUsersTurn}}
		<button class="end-turn">End Turn</button>
	{{/if}}

	<h2>Cheat</h2>
	<h3>Gimme:</h3>
	<button class="raid-common">Commons for Everyone!</button>
	<button class="raid-rare">Rares for Everyone!</button>

	<h3>Reset:</h3>
	<button class="reset-raids">Cancel all raids</button>
	<button class="reset-offerings">Cancel all offerings</button>

	<h3>Peek:</h3>
	<h4>Omen Deck:</h4>
	<ol>
	{{#each currentState.omenDeck}}
		<li>{{this}}</li>
	{{/each}}
	</ol>
	<h4>Offering Deck:</h4>
	<ol>
	{{#each currentState.offeringDeck}}
		<li>{{this}}</li>
	{{/each}}
	</ol>
</template>

<template name="stash">
  <h4>Stash</h4>
	<table class="table">
    <thead>
      <tr>
        <th></th>
        <th class="text-center"><img src="/images/cube-blue.png" title="Blue" alt="Blue" height="16" width="16"></th>
        <th class="text-center"><img src="/images/cube-green.png" title="Green" alt="Green" height="16" width="16"></th>
        <th class="text-center"><img src="/images/cube-red.png" title="Red" alt="Red" height="16" width="16"></th>
        <th class="text-center"><img src="/images/cube-purple.png" title="Purple" alt="Purple" height="16" width="16"></th>
        <th class="text-center"><img src="/images/geld.png" title="Geld" alt="Geld" height="16" width="16"></th>
        <th class="text-center">Prestige</th>
        <th class="text-center">Gods</th>
        <th class="text-center">Einherjar</th>
        <th class="text-center">Weregeld</th>
      </tr>
    </thead>
    {{#each currentState.players}}
      <tr>
        <td>{{#if isUser}}<em>You - </em>{{/if}}{{user.name}}</td>
        <td class="text-center">{{stash.blue}}{{#if canTrade}}<button class="give-resource btn btn-default" value="blue:{{user._id}}">Give 1</button>{{/if}}</td>
        <td class="text-center">{{stash.green}}{{#if canTrade}}<button class="give-resource btn btn-default" value="green:{{user._id}}">Give 1</button>{{/if}}</td>
        <td class="text-center">{{stash.red}}{{#if canTrade}}<button class="give-resource btn btn-default" value="red:{{user._id}}">Give 1</button>{{/if}}</td>
        <td class="text-center">{{stash.purple}}{{#if canTrade}}<button class="give-resource btn btn-default" value="purple:{{user._id}}">Give 1</button>{{/if}}</td>
        <td class="text-center">{{stash.geld}}{{#if canTrade}}<button class="give-resource btn btn-default" value="geld:{{user._id}}">Give 1</button>{{/if}}</td>
        <td class="text-center">{{stash.prestige}}</td>
        <td class="text-center">{{stash.gods}}</td>
        <td class="text-center">{{stash.einherjar}}</td>
        <td class="text-center">{{stash.weregeld}}</td>
      </tr>
    {{/each}}
	</table>
</template>

<template name="todo">
  <h1>TODO</h1>
  <ul>
    <li>End game screen</li>
    <li>Improve UX</li>
      <ul>
        <li>Show marketplace costs when picking resources</li>
        <li>Add tips during resource picking about which resource you are making easy/excluding</li>
        <li>Show all stuff for a single player in one place rather than multiple tables</li>
        <li>Boostrapify the game page</li>
      </ul>
    <li>Don't allow actions that can't be taken</li>
    <li>Make action with decisions modal</li>
    <li>Log actions</li>
    <li>Clean up code</li>
    <li>Give confirmation when server has accepted an action</li>
    <li>Make sure all actions are updated in the db atomically</li>

  </ul>
</template>